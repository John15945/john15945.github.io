(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d6fb162"],{"024d":function(e,t,a){"use strict";a("8b7b")},"13c4":function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return o}));var i=a("b775"),n="";function r(e){return Object(i["a"])({url:"".concat(n,"/api-project/project/findProjects"),method:"get",params:e})}function s(e){return Object(i["a"])({url:"".concat(n,"/api-project/project/saveOrUpdate"),method:"post",isJson:!0,data:JSON.stringify(e)})}function o(e){return Object(i["a"])({url:"".concat(n,"/api-project/project/saveOrUpdate"),method:"post",isJson:!0,data:JSON.stringify(e)})}},"21ab":function(e,t,a){},"4dd6":function(e,t,a){"use strict";a("c82f")},"5f78":function(e,t,a){},"8b7b":function(e,t,a){},b699:function(e,t,a){"use strict";a("5f78")},c82f:function(e,t,a){},e417:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("el-page-header",{attrs:{content:"数据权限管理"},on:{back:e.goBack}}),a("el-tabs",{staticClass:"mt-10",on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"全局数据管理员",name:"first"}},[a("global-data-admin")],1),a("el-tab-pane",{attrs:{label:"数据责任人",name:"second"}},[a("data-liable")],1),a("el-tab-pane",{attrs:{label:"项目数据管理员",name:"third"}},[a("project-data-admin")],1)],1)],1)},n=[],r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("section",{staticClass:"search-form_btn"},[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.createProject}},[e._v("添加项目")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{prop:"proName",label:"项目名"}}),a("el-table-column",{attrs:{label:"权限类型"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.privileges,(function(t,i){return a("span",{key:i,staticClass:"span-roles"},[e._v(e._s(t))])}))}}])}),a("el-table-column",{attrs:{label:"操作",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"user-info-btn",on:{click:function(a){return e.updateProjectMember(t.row)}}},[e._v("修改")])]}}])})],1),a("div",{staticClass:"mt-20"},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),a("el-dialog",{attrs:{title:e.currentTitle,visible:e.dialogShow,width:"30%",center:""},on:{"update:visible":function(t){e.dialogShow=t}}},[a("el-form",{ref:"dataPermissionForm",attrs:{model:e.dataForm,rules:e.dataFormRules,"label-width":"120px","label-position":"left"}},[a("el-form-item",{attrs:{label:"项目",prop:"projectName"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:!0,clearable:"",placeholder:"项目",disabled:e.isDisable},model:{value:e.dataForm.projectName,callback:function(t){e.$set(e.dataForm,"projectName",t)},expression:"dataForm.projectName"}},[e.projectList.length>0?e._l(e.projectList,(function(t){return a("el-option",{key:t.id,attrs:{value:t.name}},[e._v(" "+e._s(t.name)+" ")])})):e._e()],2)],1),a("el-form-item",{attrs:{label:"权限类型",prop:"type"}},[a("el-checkbox-group",{model:{value:e.dataForm.type,callback:function(t){e.$set(e.dataForm,"type",t)},expression:"dataForm.type"}},e._l(e.permissionList,(function(t,i){return a("el-checkbox",{key:i,attrs:{label:t}},[e._v(e._s(t))])})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.fnCancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.fnComfirm}},[e._v("确 定")])],1)],1)],1)},s=[],o=(a("d3b7"),a("13c4")),l=a("b775"),c="";function u(e){return Object(l["a"])({url:"".concat(c,"/api-dataManage/privilegeManage/findProjectPrivileges"),method:"post",params:e})}function d(e){return Object(l["a"])({url:"".concat(c,"/api-dataManage/privilegeManage/addProjectPrivileges"),method:"post",isJson:!0,data:JSON.stringify(e)})}function f(e){return Object(l["a"])({url:"".concat(c,"/api-dataManage/privilegeManage/updateProjectPrivileges"),method:"post",isJson:!0,data:JSON.stringify(e)})}var m=function(e){return Object(l["c"])("".concat(c,"/api-dataManage/privilegeManage/findTableOwner"),e)},p=function(e){return Object(l["c"])("".concat(c,"/api-dataManage/privilegeManage/addTableOwner"),e)},g=function(e){return Object(l["c"])("".concat(c,"/api-dataManage/privilegeManage/updateTableOwner"),e)},h=function(e){return Object(l["c"])("".concat(c,"/api-dataManage/privilegeManage/findUserPrivileges"),e)};function b(e){return Object(l["a"])({url:"".concat(c,"/api-dataManage/privilegeManage/updateUserPrivileges"),method:"post",isJson:!0,isXRoleHeader:!0,data:JSON.stringify(e)})}var v={name:"GlobalDataAdmin",data:function(){return{tableData:[],loading:!1,total:0,current:1,size:10,dialogShow:!1,isDisable:!1,permissionList:["SELECT","INSERT","UPDATE","DELETE"],currentTitle:"添加项目",dataForm:{projectName:"",type:[]},dataFormRules:{projectName:[{required:!0,message:"请选择项目",trigger:"blur"}],type:[{required:!0,message:"请选择权限类型",trigger:"blur"}]},projectList:[],curProjectId:null,routeInfo:{}}},created:function(){this.routeInfo=this.$route.query||{}},mounted:function(){this.getDataList(),this.getProjectList()},methods:{getProjectList:function(){var e=this;Object(o["b"])({page:1,limit:1e3}).then((function(t){e.projectList=(null===t||void 0===t?void 0:t.data)||[]})).catch((function(){}))},getDataList:function(){var e,t=this;this.loading=!0,u({current:this.current,size:this.size,tableId:null===(e=this.routeInfo)||void 0===e?void 0:e.tableId}).then((function(e){if(0===e.resp_code){var a=null===e||void 0===e?void 0:e.datas,i=a.records,n=a.total;t.tableData=i,t.total=n}else t.tableData=[],t.total=0})).finally((function(){t.loading=!1}))},handleSizeChange:function(e){this.size=e,this.getDataList()},handleCurrentChange:function(e){this.current=e,this.getDataList()},createProject:function(){this.dataFormRules.projectName[0].required=!0,this.currentTitle="添加项目",this.isDisable=!1,this.dialogShow=!0,this.dataForm={projectName:"",type:[]}},createMethod:function(e){var t=this;d({proId:2,tableId:4974,privileges:e.type}).then((function(e){0===e.resp_code?(t.$message({type:"success",message:"添加成功!"}),t.fnCancel(),t.getDataList()):t.$message({type:"error",message:e.resp_msg})})).finally((function(){}))},updateProjectMember:function(e){this.dataFormRules.projectName[0].required=!1,this.currentTitle="修改项目",this.isDisable=!0,this.dialogShow=!0,this.dataForm={id:e.proId,projectName:e.proName,type:e.privileges}},updateMethod:function(e){var t,a=this;f({proId:e.id,tableId:null===(t=this.routeInfo)||void 0===t?void 0:t.tableId,privileges:e.type}).then((function(e){0===e.resp_code?(a.$message({type:"success",message:"修改成功!"}),a.fnCancel(),a.getDataList()):a.$message({type:"error",message:e.resp_msg})})).finally((function(){}))},fnCancel:function(){this.$refs["dataPermissionForm"].resetFields(),this.dialogShow=!1},fnComfirm:function(){var e=this;this.$refs["dataPermissionForm"].validate((function(t){if(t){var a=Object.assign({},e.dataForm);"添加项目"===e.currentTitle?e.createMethod(a):e.updateMethod(a)}}))}}},y=v,j=(a("b699"),a("2877")),C=Object(j["a"])(y,r,s,!1,null,"28ff1af7",null),_=C.exports,D=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("section",{staticClass:"search-form_btn"},[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.addUser}},[e._v("添加数据负责人")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{prop:"username",label:"负责人"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"user-info-btn",on:{click:function(a){return e.updateTableData(t.row)}}},[e._v("修改")])]}}])})],1),a("div",{staticClass:"mt-20"},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),a("el-dialog",{attrs:{title:e.currentTitle,visible:e.dialogVisable,width:"30%",center:""},on:{"update:visible":function(t){e.dialogVisable=t}}},[a("el-form",{ref:"dataForm",attrs:{model:e.form,"label-position":"left","label-width":"80px",rules:e.formRules}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:!0,clearable:"",placeholder:"用户名"},on:{change:e.fnChangeUser},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}},[e.userList.length>0?e._l(e.userList,(function(t){return a("el-option",{key:t.id,attrs:{value:t.username}},[e._v(" "+e._s(t.username)+" ")])})):e._e()],2)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.fnCancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.fnComfirm}},[e._v("确 定")])],1)],1)],1)},I=[],k=(a("7db0"),a("c24f")),F={name:"DataLiable",data:function(){return{tableData:[],loading:!0,total:0,current:1,size:10,currentTitle:"添加数据负责人",dialogVisable:!1,form:{username:""},formRules:{username:[{required:!0,message:"请选择用户",trigger:"blur"}]},userList:[],routeInfo:{}}},created:function(){this.routeInfo=this.$route.query||{}},mounted:function(){this.getUserList(),this.getDataList()},methods:{getUserList:function(){var e=this;Object(k["j"])({userName:""}).then((function(t){e.userList=t})).catch((function(){}))},getDataList:function(){var e,t,a,i=this;this.loading=!0,m({current:this.current,size:this.size,datasourceId:null===(e=this.routeInfo)||void 0===e?void 0:e.datasourceId,dbName:null===(t=this.routeInfo)||void 0===t?void 0:t.dbName,tableName:null===(a=this.routeInfo)||void 0===a?void 0:a.tableName}).then((function(e){if(0===e.resp_code){var t=null===e||void 0===e?void 0:e.datas,a=t.records,n=t.total;i.tableData=a,i.total=n}else i.tableData=[],i.total=0})).finally((function(){i.loading=!1}))},handleSizeChange:function(e){this.size=e,this.getDataList()},handleCurrentChange:function(e){this.current=e,this.getDataList()},addUser:function(){this.dialogVisable=!0,this.currentTitle="添加数据负责人",this.form={username:""}},createMethod:function(e){var t=this,a=Object.assign({},e);p(a).then((function(e){0===e.resp_code?(t.$message({type:"success",message:"添加成功!"}),t.fnCancel(),t.getDataList()):t.$message({type:"error",message:e.resp_msg})})).finally((function(){}))},fnChangeUser:function(e){this.form.username=e;var t=this.userList.find((function(t){return t.username===e}));this.form.id=t&&t.id},updateTableData:function(e){this.currentTitle="修改数据负责人",this.dialogVisable=!0,this.form={id:e.id,username:e.username}},updateMethod:function(e){var t=this,a=Object.assign({},e);g(a).then((function(e){0===e.resp_code?(t.$message({type:"success",message:"修改成功!"}),t.fnCancel(),t.getDataList()):t.$message({type:"error",message:e.resp_msg})})).finally((function(){}))},fnCancel:function(){this.$refs["dataForm"].resetFields(),this.dialogVisable=!1},fnComfirm:function(){var e=this;this.$refs["dataForm"].validate((function(t){if(t){var a,i,n,r={datasourceId:null===(a=e.routeInfo)||void 0===a?void 0:a.datasourceId,dbName:null===(i=e.routeInfo)||void 0===i?void 0:i.dbName,tableName:null===(n=e.routeInfo)||void 0===n?void 0:n.tableName,userId:e.form.id};"添加数据负责人"===e.currentTitle?e.createMethod(r):e.updateMethod(r)}}))}}},L=F,w=(a("4dd6"),Object(j["a"])(L,D,I,!1,null,"2979a0f7",null)),N=w.exports,S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{prop:"username",label:"成员姓名"}}),a("el-table-column",{attrs:{prop:"privileges",label:"权限类型"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.privileges&&t.row.privileges.length>0?e._l(t.row.privileges,(function(t,i){return a("span",{key:i,staticClass:"span-roles"},[e._v(e._s(t))])})):void 0}}],null,!0)}),a("el-table-column",{attrs:{label:"操作",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"user-info-btn",on:{click:function(a){return e.updateTableData(t.row)}}},[e._v("修改")])]}}])})],1),a("div",{staticClass:"mt-20"},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),a("el-dialog",{attrs:{title:e.currentTitle,visible:e.dialogVisable,width:"30%",center:""},on:{"update:visible":function(t){e.dialogVisable=t}}},[a("el-form",{ref:"dataForm",attrs:{model:e.dataForm,rules:e.dataFormRules,"label-width":"120px","label-position":"left"}},[a("el-form-item",{attrs:{label:"成员姓名"}},[a("el-input",{attrs:{disabled:""},model:{value:e.dataForm.username,callback:function(t){e.$set(e.dataForm,"username",t)},expression:"dataForm.username"}})],1),a("el-form-item",{attrs:{label:"权限类型",prop:"type"}},[a("el-checkbox-group",{model:{value:e.dataForm.type,callback:function(t){e.$set(e.dataForm,"type",t)},expression:"dataForm.type"}},e._l(e.permissionList,(function(t,i){return a("el-checkbox",{key:i,attrs:{label:t}},[e._v(e._s(t))])})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.fnCancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.fnComfirm}},[e._v("确 定")])],1)],1)],1)},O=[],z={name:"ProjectDataAdmin",data:function(){return{tableData:[],loading:!1,total:0,page:1,size:10,dialogVisable:!1,currentTitle:"修改",permissionList:["SELECT","INSERT","UPDATE","DELETE"],dataForm:{username:"",type:[]},dataFormRules:{type:[{required:!0,message:"请选择权限类型",trigger:"blur"}]},routeInfo:{}}},created:function(){this.routeInfo=this.$route.query||{}},mounted:function(){this.getDataList()},methods:{getDataList:function(){var e,t=this;this.loading=!0,h({current:this.page,size:this.size,tableId:null===(e=this.routeInfo)||void 0===e?void 0:e.tableId,currentProjectId:2}).then((function(e){if(0===e.resp_code){var a=null===e||void 0===e?void 0:e.datas,i=a.records,n=a.total;t.tableData=i,t.total=n}else t.tableData=[],t.total=0})).finally((function(){t.loading=!1}))},handleSizeChange:function(e){this.size=e,this.getDataList()},handleCurrentChange:function(e){this.page=e,this.getDataList()},updateTableData:function(e){this.currentTitle="修改";var t=(null===e||void 0===e?void 0:e.privileges)||[];this.dataForm={userId:e.userId,username:e.username,type:t},this.dialogVisable=!0},updateMethod:function(e){var t=this,a=Object.assign({},e);b(a).then((function(e){0===e.resp_code?(t.$message({type:"success",message:"修改成功!"}),t.fnCancel(),t.getDataList()):t.$message({type:"error",message:e.resp_msg})})).finally((function(){}))},fnCancel:function(){this.$refs["dataForm"].resetFields(),this.dialogVisable=!1},fnComfirm:function(){var e=this;this.$refs["dataForm"].validate((function(t){if(t){var a,i,n,r={currentProjectId:2,tableId:null===(a=e.routeInfo)||void 0===a?void 0:a.tableId,userId:null===(i=e.dataForm)||void 0===i?void 0:i.userId,privileges:null===(n=e.dataForm)||void 0===n?void 0:n.type};"修改"===e.currentTitle&&e.updateMethod(r)}}))}}},M=z,T=(a("024d"),Object(j["a"])(M,S,O,!1,null,"0ecfaa02",null)),$=T.exports,x={name:"DataPermissionManagement",components:{GlobalDataAdmin:_,DataLiable:N,ProjectDataAdmin:$},data:function(){return{activeName:"first"}},mounted:function(){},methods:{goBack:function(){this.$router.go(-1)},handleClick:function(e){}}},P=x,E=(a("ed45"),Object(j["a"])(P,i,n,!1,null,"358631a0",null));t["default"]=E.exports},ed45:function(e,t,a){"use strict";a("21ab")}}]);